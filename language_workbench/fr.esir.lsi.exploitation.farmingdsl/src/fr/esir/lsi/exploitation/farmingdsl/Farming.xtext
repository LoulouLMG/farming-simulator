// automatically generated by Xtext
grammar fr.esir.lsi.exploitation.farmingdsl.Farming with org.eclipse.xtext.common.Terminals

import "http://www.eclipse.org/emf/2002/Ecore" as ecore
import "platform:/resource/fr.esir.lsi.exploitation/model/activity.ecore" as activity
import "platform:/resource/fr.esir.lsi.exploitation/model/exploitation.ecore" as exploitation

Model returns activity::Model:
	{activity::Model}
	'model'
	'{'
		('ressourceTypes' ': ' ressourceTypes+=ResourceType ( "," ressourceTypes+=ResourceType)*  )?
		('activities' '{' activities+=PeriodicActivity ( "," activities+=PeriodicActivity)* '}' )?
	'}';
	

ResourceType returns activity::ResourceType:
	{activity::ResourceType}
	name=EString;

PeriodicActivity returns activity::PeriodicActivity:
	{activity::PeriodicActivity}
	'PeriodicActivity '
	name=EString '{'
		('each' periodicity=EInt periodicityLitteral=Periodic)?
		('from' start=Date 'to' end=Date)?		
		('rules' '{' rules+=Rule ( "," rules+=Rule)* '}' )?
		('allocations' '{' allocations+=ResourceAllocation ( "," allocations+=ResourceAllocation)* '}' )?
	'}';

EString returns ecore::EString:
	STRING | ID;

EInt returns ecore::EInt:
	'-'? INT;

Date returns activity::Date:
	{activity::Date}
	day=INT
	month=Month
	year=INT;



Rule returns activity::Rule:
	{activity::Rule}
	( predicates+=Predicate ( (","|"OR"|"AND") predicates+= (Predicate))* )?;

ResourceAllocation returns activity::ResourceAllocation:
	'resource' resource=[activity::ResourceType|EString] 
		('for' duration= EInt 'hours')?
	;

Predicate returns activity::Predicate:
	{activity::Predicate}
	
	(  ('no rained the last ' EInt ' days')
	 | ('temperature ' linkedSymbol=Symbol 'than' EInt '0C') 
	 | ('t 'linkedSymbol=Symbol 'than' linkedDate=Date )
	 | (('ray'|'par') linkedSymbol=Symbol 'than' EInt )
	 | ('seed maturity')
	 | (EInt ('hours'|'days'|'weeks'|'months'|'years') 'after' linkedActivity=[activity::PeriodicActivity|EString])
	)
	;
	
	
/*Enumeration */

enum Month returns activity::Month:
	january|february|march|april|may|june|july|august|september|october|november|december;
	
enum Symbol returns activity::Symbol:
	supequals|sup|equals|inf|infequals;
	
enum Periodic returns activity::Periodic:
	year|month|week|day;
